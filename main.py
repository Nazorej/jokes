# –≠—Ç–æ –ø—Ä–æ–≥—Ä–∞–º–º–∞ –Ω–∞ Python
# –ò–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º –º–æ–¥—É–ª–∏
import sqlite3
import random
import time
from PyQt5.QtWidgets import QApplication, QLabel, QDesktopWidget, QPushButton
from PyQt5.QtGui import QFont, QIcon
from PyQt5.QtCore import Qt
from PyQt5.QtCore import QTime, QTimer
from datetime import datetime

# –ü–æ–¥–∫–ª—é—á–∞–µ–º—Å—è –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö anecdotes.db
conn = sqlite3.connect("anecdotes.db")
c = conn.cursor()

# –ü–æ–ª—É—á–∞–µ–º —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –∞–Ω–µ–∫–¥–æ—Ç–æ–≤
c.execute("SELECT text FROM anecdotes")
quotes = c.fetchall()

# –ó–∞–∫—Ä—ã–≤–∞–µ–º —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö
conn.close()

# –°–æ–∑–¥–∞–µ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ PyQt
app = QApplication([])

# –°–æ–∑–¥–∞–µ–º –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –∏–Ω—Ç–µ—Ä–≤–∞–ª–∞ —Ç–∞–π–º–µ—Ä–∞ –≤ —Å–µ–∫—É–Ω–¥–∞—Ö (1800 —Å–µ–∫—É–Ω–¥ = 30 –º–∏–Ω—É—Ç)
interval = 1800

# –°–æ–∑–¥–∞–µ–º –º–µ—Ç–∫—É –¥–ª—è –≤—ã–≤–æ–¥–∞ –∞–Ω–µ–∫–¥–æ—Ç–æ–≤
label = QLabel()

# –£–º–µ–Ω—å—à–∞–µ–º –æ–∫–Ω–æ –ø–æ —à–∏—Ä–∏–Ω–µ –∏ —É–≤–µ–ª–∏—á–∏–≤–∞–µ–º –ø–æ –≤—ã—Å–æ—Ç–µ
label.resize(600, 300)

# –ü–µ—Ä–µ–º–µ—â–∞–µ–º –æ–∫–Ω–æ –Ω–µ–º–Ω–æ–≥–æ –≤—ã—à–µ —Ü–µ–Ω—Ç—Ä–∞ —ç–∫—Ä–∞–Ω–∞
screen = app.primaryScreen()
screen_size = screen.size()
window_size = label.size()
x = (screen_size.width() - window_size.width()) // 2
y = (screen_size.height() - window_size.height()) // 4
label.move(x, y)

# –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –æ–∫–Ω–æ
label.show()

# –°–æ–∑–¥–∞–µ–º —à—Ä–∏—Ñ—Ç —Å –∑–∞–¥–∞–Ω–Ω—ã–º —Ä–∞–∑–º–µ—Ä–æ–º –∏ –∂–∏—Ä–Ω–æ—Å—Ç—å—é
font = QFont()
font.setPointSize(27)
font.setBold(True)

# –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —à—Ä–∏—Ñ—Ç –¥–ª—è –º–µ—Ç–∫–∏
label.setFont(font)

x = x + 325
# –°–¥–≤–∏–Ω—É—Ç—å –æ–∫–Ω–æ –≤–ø—Ä–∞–≤–æ –Ω–∞ 50 –ø–∏–∫—Å–µ–ª–µ–π

y = y - 140
# –ü—Ä–∏–ø–æ–¥–Ω—è—Ç—å –æ–∫–Ω–æ –≤–≤–µ—Ä—Ö –Ω–∞ 50 –ø–∏–∫—Å–µ–ª–µ–π
label.move(x, y)

# –í–∫–ª—é—á–∞–µ–º –ø–µ—Ä–µ–Ω–æ—Å —Ç–µ–∫—Å—Ç–∞ –ø–æ —Å–ª–æ–≤–∞–º –¥–ª—è –º–µ—Ç–∫–∏
label.setWordWrap(True)

# –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å –æ–∫–Ω–∞
label.setWindowOpacity(1)

# –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –Ω–∞–∑–≤–∞–Ω–∏–µ –æ–∫–Ω–∞ - "–ê–Ω–µ–∫–¥–æ—Ç—ã"
label.setWindowTitle("–ê–Ω–µ–∫–¥–æ—Ç—ã")

# –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∏–∫–æ–Ω–∫—É –æ–∫–Ω–∞ –∏–∑ —Ñ–∞–π–ª–∞ favicon.jpg
icon = QIcon("favicon.jpg")
label.setWindowIcon(icon)

# –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –≤—ã—Ä–∞–≤–Ω–∏–≤–∞–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞ –ø–æ –≤–µ—Ä—Ö–Ω–µ–º—É –∫—Ä–∞—é –¥–ª—è –º–µ—Ç–∫–∏
label.setAlignment(Qt.AlignTop)

# –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –æ—Ç—Å—Ç—É–ø –æ—Ç –∫—Ä–∞–µ–≤ –æ–∫–Ω–∞ –≤ 20 –ø–∏–∫—Å–µ–ª–µ–π –¥–ª—è –º–µ—Ç–∫–∏
label.setContentsMargins(20, 20, 60, 20)

# –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ü–≤–µ—Ç —Ç–µ–∫—Å—Ç–∞ –≤ –±–µ–ª—ã–π –¥–ª—è –º–µ—Ç–∫–∏
label.setStyleSheet("color: #272727")

# –°–æ–∑–¥–∞–µ–º –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è –∫–Ω–æ–ø–∫–∏ –ª–∞–π–∫–∞
liked = False

# –°–æ–∑–¥–∞–µ–º –∫–Ω–æ–ø–∫—É –¥–ª—è –ª–∞–π–∫–∞ –∞–Ω–µ–∫–¥–æ—Ç–æ–≤
like_button = QPushButton("üê¶", label)

# –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —à—Ä–∏—Ñ—Ç –¥–ª—è –∫–Ω–æ–ø–∫–∏
like_button.setFont(font)

# –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ä–∞–∑–º–µ—Ä –∫–Ω–æ–ø–∫–∏
like_button.resize(50, 50)

# –ü–µ—Ä–µ–º–µ—â–∞–µ–º –∫–Ω–æ–ø–∫—É –≤ –ø—Ä–∞–≤—ã–π –Ω–∏–∂–Ω–∏–π —É–≥–æ–ª –æ–∫–Ω–∞
like_button.move(label.width() - like_button.width() - 20, label.height() - like_button.height() - 20)

# –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É
like_button.show()

# –ü–µ—Ä–µ–º–µ—â–∞–µ–º –∫–Ω–æ–ø–∫—É –≤ –ø—Ä–∞–≤—ã–π –≤–µ—Ä—Ö–Ω–∏–π —É–≥–æ–ª –æ–∫–Ω–∞
like_button.move(label.width() - like_button.width() - 20, 20)

# –°–æ–∑–¥–∞–µ–º —Ñ—É–Ω–∫—Ü–∏—é –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –Ω–∞–∂–∞—Ç–∏—è –Ω–∞ –∫–Ω–æ–ø–∫—É –ª–∞–π–∫–∞
def like_quote():

    # –û–±—ä—è–≤–ª—è–µ–º –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é liked –∫–∞–∫ –≥–ª–æ–±–∞–ª—å–Ω—É—é, —á—Ç–æ–±—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –µ–µ –≤ –¥—Ä—É–≥–∏—Ö —Ñ—É–Ω–∫—Ü–∏—è—Ö
    global liked

    # –ï—Å–ª–∏ –∞–Ω–µ–∫–¥–æ—Ç –µ—â–µ –Ω–µ –±—ã–ª –ª–∞–π–∫–Ω—É—Ç
    if not liked:

        # –û–±–Ω–æ–≤–ª—è–µ–º –ø–æ–ª–µ liked –≤ —Ç–∞–±–ª–∏—Ü–µ –∏—Å—Ç–æ—Ä–∏–∏ –¥–ª—è —Ç–µ–∫—É—â–µ–≥–æ –∞–Ω–µ–∫–¥–æ—Ç–∞
        c2.execute("UPDATE history SET liked = 1 WHERE text = ?", (quote[0],))
        conn2.commit()

        # –í—ã–≤–æ–¥–∏–º —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± —É—Å–ø–µ—à–Ω–æ–º –ª–∞–π–∫–µ
        label.setText(f"{quote[0]}\n\n–í—ã –ø–æ—Å—Ç–∞–≤–∏–ª–∏ –ª–∞–π–∫ —ç—Ç–æ–º—É –∞–Ω–µ–∫–¥–æ—Ç—É!")

        # –ú–µ–Ω—è–µ–º —Ç–µ–∫—Å—Ç –∫–Ω–æ–ø–∫–∏ –ª–∞–π–∫–∞ –Ω–∞ üëç
        like_button.setText("üëç")

        # –ú–µ–Ω—è–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∫–Ω–æ–ø–∫–∏ –ª–∞–π–∫–∞ –Ω–∞ True
        liked = True

    # –ò–Ω–∞—á–µ, –µ—Å–ª–∏ –∞–Ω–µ–∫–¥–æ—Ç —É–∂–µ –±—ã–ª –ª–∞–π–∫–Ω—É—Ç
    else:

        # –û–±–Ω–æ–≤–ª—è–µ–º –ø–æ–ª–µ liked –≤ —Ç–∞–±–ª–∏—Ü–µ –∏—Å—Ç–æ—Ä–∏–∏ –¥–ª—è —Ç–µ–∫—É—â–µ–≥–æ –∞–Ω–µ–∫–¥–æ—Ç–∞
        c2.execute("UPDATE history SET liked = 0 WHERE text = ?", (quote[0],))
        conn2.commit()

        # –ú–µ–Ω—è–µ–º —Ç–µ–∫—Å—Ç –∫–Ω–æ–ø–∫–∏ –ª–∞–π–∫–∞ –Ω–∞ üê¶
        like_button.setText("üê¶")

        # –ú–µ–Ω—è–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∫–Ω–æ–ø–∫–∏ –ª–∞–π–∫–∞ –Ω–∞ False
        liked = False

# –°–æ–∑–¥–∞–µ–º —Ñ—É–Ω–∫—Ü–∏—é –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Ç–∞–π–º–µ—Ä–∞
def update_timer():
    # –î–æ–±–∞–≤–ª—è–µ–º –æ–¥–Ω—É —Å–µ–∫—É–Ω–¥—É –∫ –æ–±—ä–µ–∫—Ç—É –≤—Ä–µ–º–µ–Ω–∏
    time.addSecs(1)
    # –í—ã–≤–æ–¥–∏–º –≤—Ä–µ–º—è –≤ —Ñ–æ—Ä–º–∞—Ç–µ MM:SS –Ω–∞ –º–µ—Ç–∫—É
    label.setText(time.toString("mm:ss"))

# –°–≤—è–∑—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É —Å —Ñ—É–Ω–∫—Ü–∏–µ–π –ª–∞–π–∫–∞
like_button.clicked.connect(like_quote)

# –°–æ–∑–¥–∞–µ–º –Ω–æ–≤—É—é –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö SQLite –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –∏—Å—Ç–æ—Ä–∏–∏
conn2 = sqlite3.connect("history.db")
c2 = conn2.cursor()

# –°–æ–∑–¥–∞–µ–º —Ç–∞–±–ª–∏—Ü—É –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –∏—Å—Ç–æ—Ä–∏–∏ —Å –ø–æ–ª–µ–º –¥–∞—Ç—ã –∏ –≤—Ä–µ–º–µ–Ω–∏
c2.execute("CREATE TABLE IF NOT EXISTS history (text TEXT, date_time TEXT, liked INTEGER)")
conn2.commit()

# –°–æ–∑–¥–∞–µ–º —Ñ—É–Ω–∫—Ü–∏—é –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∞–Ω–µ–∫–¥–æ—Ç–æ–≤
def update_quote():

    # –°–æ–∑–¥–∞–µ–º –æ–±—ä–µ–∫—Ç –≤—Ä–µ–º–µ–Ω–∏ —Å –Ω–∞—á–∞–ª—å–Ω—ã–º –∑–Ω–∞—á–µ–Ω–∏–µ–º 00:00:00
    time = QTime(0, 0, 0)

    # –û–±—ä—è–≤–ª—è–µ–º –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é quote –∫–∞–∫ –≥–ª–æ–±–∞–ª—å–Ω—É—é, —á—Ç–æ–±—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –µ–µ –≤ –¥—Ä—É–≥–∏—Ö —Ñ—É–Ω–∫—Ü–∏—è—Ö
    global quote

    # –í—ã–±–∏—Ä–∞–µ–º —Å–ª—É—á–∞–π–Ω—ã–π –∞–Ω–µ–∫–¥–æ—Ç –∏–∑ —Å–ø–∏—Å–∫–∞
    quote = random.choice(quotes)

    # –í—ã–≤–æ–¥–∏–º –∞–Ω–µ–∫–¥–æ—Ç –Ω–∞ –º–µ—Ç–∫—É
    label.setText(f"{quote[0]}")

    # –ü–æ–ª—É—á–∞–µ–º —Ç–µ–∫—É—â—É—é –¥–∞—Ç—É –∏ –≤—Ä–µ–º—è –≤ —Ñ–æ—Ä–º–∞—Ç–µ YYYY-MM-DD HH:MM:SS
    date_time = datetime.now().strftime("%Y-%m-%d %H:%M:%S")

    # –°–æ—Ö—Ä–∞–Ω—è–µ–º –∞–Ω–µ–∫–¥–æ—Ç—ã, –¥–∞—Ç—É –∏ –≤—Ä–µ–º—è –≤ —Ç–∞–±–ª–∏—Ü—É –∏—Å—Ç–æ—Ä–∏–∏
    c2.execute("INSERT INTO history VALUES (?, ?, ?)", (quote[0], date_time, 0))
    conn2.commit()

def update_counter():
    # –£–º–µ–Ω—å—à–∞–µ–º –∑–Ω–∞—á–µ–Ω–∏–µ –∏–Ω—Ç–µ—Ä–≤–∞–ª–∞ –Ω–∞ –µ–¥–∏–Ω–∏—Ü—É
    global interval; interval -= 1

    # –û–±–Ω–æ–≤–ª—è–µ–º —Ç–µ–∫—Å—Ç –º–µ—Ç–∫–∏ —Å –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ–º —Å—á–µ—Ç—á–∏–∫–∞ –≤ —Ñ–æ—Ä–º–∞—Ç–µ MM:SS
    label.setText(f"{quote[0]}\n\n{time.strftime('%M:%S', time.gmtime(interval))}")

# –°–æ–∑–¥–∞–µ–º —Ç–∞–π–º–µ—Ä PyQt –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∞–Ω–µ–∫–¥–æ—Ç–æ–≤
timer = QTimer()

# –°–æ–∑–¥–∞–µ–º —Ç–∞–π–º–µ—Ä PyQt –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—á–µ—Ç—á–∏–∫–∞
counter_timer = QTimer()

# –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∏–Ω—Ç–µ—Ä–≤–∞–ª —Ç–∞–π–º–µ—Ä–∞ —Å—á–µ—Ç—á–∏–∫–∞ –≤ 100 –º–∏–ª–ª–∏—Å–µ–∫—É–Ω–¥
counter_timer.setInterval(100)

# –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∏–Ω—Ç–µ—Ä–≤–∞–ª —Ç–∞–π–º–µ—Ä–∞ –≤ 30 –º–∏–Ω—É—Ç (1800000 –º–∏–ª–ª–∏—Å–µ–∫—É–Ω–¥)
timer.setInterval(1800000)

# –°–≤—è–∑—ã–≤–∞–µ–º —Ç–∞–π–º–µ—Ä —Å —Ñ—É–Ω–∫—Ü–∏–µ–π –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—á–µ—Ç—á–∏–∫–∞
counter_timer.timeout.connect(update_counter)

# –ó–∞–ø—É—Å–∫–∞–µ–º —Ç–∞–π–º–µ—Ä
counter_timer.start()

# –°–≤—è–∑—ã–≤–∞–µ–º —Ç–∞–π–º–µ—Ä —Å —Ñ—É–Ω–∫—Ü–∏–µ–π –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∞–Ω–µ–∫–¥–æ—Ç–æ–≤
timer.timeout.connect(update_quote)

# –ó–∞–ø—É—Å–∫–∞–µ–º —Ç–∞–π–º–µ—Ä
timer.start()

# –û–±–Ω–æ–≤–ª—è–µ–º –∞–Ω–µ–∫–¥–æ—Ç—ã –≤ –ø–µ—Ä–≤—ã–π —Ä–∞–∑
update_quote()

# –ó–∞–ø—É—Å–∫–∞–µ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ PyQt
app.exec_()